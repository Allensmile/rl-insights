<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=description content="A reinforcement learning knowledge base"><meta name=author content="Florian LAURENT"><meta name=lang:clipboard.copy content="Copy to clipboard"><meta name=lang:clipboard.copied content="Copied to clipboard"><meta name=lang:search.language content=en><meta name=lang:search.pipeline.stopwords content=True><meta name=lang:search.pipeline.trimmer content=True><meta name=lang:search.result.none content="No matching documents"><meta name=lang:search.result.one content="1 matching document"><meta name=lang:search.result.other content="# matching documents"><meta name=lang:search.tokenizer content=[\s\-]+><link rel="shortcut icon" href=../assets/images/favicon.png><meta name=generator content="mkdocs-1.1, mkdocs-material-4.6.3"><title>Notebook Pitfalls - RL Insights</title><link rel=stylesheet href=../assets/stylesheets/application.adb8469c.css><link rel=stylesheet href=../assets/stylesheets/application-palette.a8b3c06d.css><meta name=theme-color content=#3f51b5><script src=../assets/javascripts/modernizr.86422ebf.js></script><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style><link rel=stylesheet href=../assets/fonts/material-icons.css><link rel=stylesheet href=../stylesheets/extra.css><link rel=stylesheet href=../css/ansi-colours.css><link rel=stylesheet href=../css/jupyter-cells.css><link rel=stylesheet href=../css/pandas-dataframe.css><script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-36471625-6", "auto")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script><script async src=https://www.google-analytics.com/analytics.js></script></head> <body dir=ltr data-md-color-primary=indigo data-md-color-accent=orange> <svg class=md-svg> <defs> <svg xmlns=http://www.w3.org/2000/svg width=416 height=448 viewbox="0 0 416 448" id=__github><path fill=currentColor d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg> </defs> </svg> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay data-md-component=overlay for=__drawer></label> <a href=#notebook-pitfalls tabindex=0 class=md-skip> Skip to content </a> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid"> <div class=md-flex> <div class="md-flex__cell md-flex__cell--shrink"> <a href=.. title="RL Insights" aria-label="RL Insights" class="md-header-nav__button md-logo"> <i class=md-icon></i> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title" data-md-component=title> <span class=md-header-nav__topic> RL Insights </span> <span class=md-header-nav__topic> Notebook Pitfalls </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--search md-header-nav__button" for=__search></label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input aria-label=search name=query placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=query data-md-state=active> <label class="md-icon md-search__icon" for=__search></label> <button type=reset class="md-icon md-search__icon" data-md-component=reset tabindex=-1> &#xE5CD; </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=result> <div class=md-search-result__meta> Type to start searching </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <div class=md-header-nav__source> <a href=https://github.com/MasterScrat/rl-insights title="Go to repository" class=md-source data-md-source=github> <div class=md-source__icon> <svg viewbox="0 0 24 24" width=24 height=24> <use xlink:href=#__github width=24 height=24></use> </svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </div> </div> </nav> </header> <div class=md-container> <main class=md-main role=main> <div class="md-main__inner md-grid" data-md-component=container> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" data-md-level=0> <label class="md-nav__title md-nav__title--site" for=__drawer> <a href=.. title="RL Insights" class="md-nav__button md-logo"> <i class=md-icon></i> </a> RL Insights </label> <div class=md-nav__source> <a href=https://github.com/MasterScrat/rl-insights title="Go to repository" class=md-source data-md-source=github> <div class=md-source__icon> <svg viewbox="0 0 24 24" width=24 height=24> <use xlink:href=#__github width=24 height=24></use> </svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. title=Home class=md-nav__link> Home </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2 type=checkbox id=nav-2> <label class=md-nav__link for=nav-2> Papers </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-2> Papers </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../curl/ title="CURL: Contrastive Unsupervised Representations for Reinforcement Learning" class=md-nav__link> CURL: Contrastive Unsupervised Representations for Reinforcement Learning </a> </li> <li class=md-nav__item> <a href=../a3c/ title="Asynchronous Methods for Deep Reinforcement Learning" class=md-nav__link> Asynchronous Methods for Deep Reinforcement Learning </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3 type=checkbox id=nav-3> <label class=md-nav__link for=nav-3> Notebooks </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-3> Notebooks </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../notebooks/RL_Research_Workflow/ title="Test notebook 1" class=md-nav__link> Test notebook 1 </a> </li> <li class=md-nav__item> <a href=../notebooks/Title_of_the_notebook/ title="Test notebook 2" class=md-nav__link> Test notebook 2 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4 type=checkbox id=nav-4 checked> <label class=md-nav__link for=nav-4> Blog </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-4> Blog </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-toggle md-nav__toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Notebook Pitfalls </label> <a href=./ title="Notebook Pitfalls" class="md-nav__link md-nav__link--active"> Notebook Pitfalls </a> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>Table of contents</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#error-prone-execution-flow class=md-nav__link> Error-prone execution flow </a> </li> <li class=md-nav__item> <a href=#poor-code-assist class=md-nav__link> Poor code assist </a> </li> <li class=md-nav__item> <a href=#i-dont-like-notebooks class=md-nav__link> "I don't like notebooks" </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../notebooks-long-tasks/ title="Running Long Tasks in Notebooks" class=md-nav__link> Running Long Tasks in Notebooks </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>Table of contents</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#error-prone-execution-flow class=md-nav__link> Error-prone execution flow </a> </li> <li class=md-nav__item> <a href=#poor-code-assist class=md-nav__link> Poor code assist </a> </li> <li class=md-nav__item> <a href=#i-dont-like-notebooks class=md-nav__link> "I don't like notebooks" </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <h1 id=notebook-pitfalls>Notebook Pitfalls<a class=headerlink href=#notebook-pitfalls title="Permanent link">&para;</a></h1> <div class="admonition tldr"> <p class=admonition-title>Tldr</p> <ul> <li>The execution flow of notebooks makes it easy to get confused by stale states.</li> <li>Code assist (autocomplete, refactoring, linting) is poor compared to modern IDEs. </li> </ul> </div> <p>Notebooks are a great way to run quick experiments and exploratory data analysis. They're also perfect to show off your work. Services such as <a href=https://colab.research.google.com/ >Google Colab</a> and <a href=https://mybinder.org/ >MyBinder</a> even provide free compute in the form of notebooks. What's not to love?</p> <p>As we will see, notebooks do come with a number of <strong>pretty bad pitfalls</strong>.</p> <p>They are still an amazing tool, but they require some careful considerations before you integrate them into your workflow.</p> <h2 id=error-prone-execution-flow>Error-prone execution flow<a class=headerlink href=#error-prone-execution-flow title="Permanent link">&para;</a></h2> <p>The first pitfall is the way code gets executed in notebooks: the execution of each cell alters the global state. There is no warranty that cells are ran in order, which can result in confusing situations if you don't keep track of cell history.</p> <p><img alt="notebook pitfall" src=../img/notebook_pitfalls_1.png></p> <p>In the example above<sup id=fnref:grus><a class=footnote-ref href=#fn:grus>1</a></sup>, the final results seems surprising. What happened is that a change was done to the global state between the first and second cell, in a cell that has since been deleted. This problem often happens with module imports or function definitions: it is easy to accidentally delete a cell that doesn't look useful anymore, only to realize later that its content was indeed needed. Since the side effect of that cell kept effect until the runtime was restarted, the problem can be overlooked for some time.</p> <p>A solution is to <strong>run "Restart Runtime and Run All" aggressively</strong>. This is your best weapon against hidden states.</p> <p><img alt="notebook pitfall" src=../img/notebook_pitfalls_2.png></p> <p>The example above<sup id=fnref2:grus><a class=footnote-ref href=#fn:grus>1</a></sup> appears even nastier at first look, but is less common in practice. Here, what happened is that the content of some cells was modified after being executed, which surprisingly is not visible from the notebook UI.</p> <p>One use case where this can happen is if you start a long running task, then start editing other parts of the code. It can quickly become confusing to remember which parts of your code where changed before and after the start of that task, which can make debugging difficult if said task doesn't complete as expected.</p> <p>A solution is to <strong>commit your notebook often</strong>, ideally every time before you start a long-running task. This ensures that you have a snapshot of the state of your notebook when the task started. The page <a href=../notebooks-long-tasks/ >Running Long Tasks in Notebooks</a> describes such workflows in more details.</p> <h2 id=poor-code-assist>Poor code assist<a class=headerlink href=#poor-code-assist title="Permanent link">&para;</a></h2> <p>Modern IDEs, such as IntelliJ, have amazing auto-complete capabilities. They will not only suggest completions as you type, but will also perform type checking and other form of sanity checks that can save you precious time.</p> <p>In contrast, autocomplete in notebooks is still terribly lackluster: <sup id=fnref3:grus><a class=footnote-ref href=#fn:grus>1</a></sup></p> <p><img alt="notebook pitfall" src=../img/notebook_pitfalls_autocomplete.png></p> <p>Notebooks don't take advantage of type information: <sup id=fnref4:grus><a class=footnote-ref href=#fn:grus>1</a></sup></p> <p><img alt="notebook pitfall" src=../img/notebook_pitfalls_autocomplete_2.png></p> <p>At this point, IDEs and notebooks provide two different approaches to improve iteration time:</p> <ul> <li>IDEs: top-notch autocomplete helps writing code faster and more confidently</li> <li>Notebooks: instant execution of each piece of code helps you check that it work as expected </li> </ul> <p>Could they be combined? I think so. Modern Javascript engines are good enough to run the advanced heuristics Eclipse or IntelliJ uses under the hood. It's hopefully only a matter of time before such approaches are implemented.</p> <p>Beyond autocompletion and type checking, IDEs offer two other invaluable tools:</p> <ul> <li>Linting: IDEs will clean up entire files to conform to PEP8 at the push of a button</li> <li>Refactoring: IDEs can perform advanced refactors, looking through multiple files</li> </ul> <p>Both of these make it easier to keep your code clean and readable.</p> <h2 id=i-dont-like-notebooks>"I don't like notebooks"<a class=headerlink href=#i-dont-like-notebooks title="Permanent link">&para;</a></h2> <p>These two points are inspired by a 2018 talk by <a href=https://joelgrus.com/ >Joel Grus</a>, a veteran Python developer and author. I recommend you watch the full video:</p> <p><a href="https://www.youtube.com/watch?v=7jiPeIFXb6U"><img alt="I don't like notebooks.- Joel Grus (Allen Institute for Artificial Intelligence)" src=https://img.youtube.com/vi/7jiPeIFXb6U/0.jpg></a></p> <p>The slide deck is also available <a href="https://docs.google.com/presentation/d/1n2RlMdmv1p25Xy5thJUhkKGvjtV-dkAIsUXP-AL4ffI/preview?slide=id.g362da58057_0_1">on Google Doc</a>.</p> <p>Joel raises many other points, such as how notebooks hinder modularity and testability, and other usability problems.</p> <div class=footnote> <hr> <ol> <li id=fn:grus> <p><a href="https://www.youtube.com/watch?v=7jiPeIFXb6U">I don't like notebooks.- Joel Grus (Allen Institute for Artificial Intelligence)</a>&#160;<a class=footnote-backref href=#fnref:grus title="Jump back to footnote 1 in the text">&#8617;</a><a class=footnote-backref href=#fnref2:grus title="Jump back to footnote 1 in the text">&#8617;</a><a class=footnote-backref href=#fnref3:grus title="Jump back to footnote 1 in the text">&#8617;</a><a class=footnote-backref href=#fnref4:grus title="Jump back to footnote 1 in the text">&#8617;</a></p> </li> </ol> </div> <hr> <div class=md-source-date> <small> Last update: April 15, 2020 </small> </div> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid"> <a href=../notebooks/Title_of_the_notebook/ title="Test notebook 2" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i> </div> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> Previous </span> Test notebook 2 </span> </div> </a> <a href=../notebooks-long-tasks/ title="Running Long Tasks in Notebooks" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel=next> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> Next </span> Running Long Tasks in Notebooks </span> </div> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; 2020 Florian Laurent </div> powered by <a href=https://www.mkdocs.org target=_blank rel=noopener>MkDocs</a> and <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs</a> </div> </div> </div> </footer> </div> <script src=../assets/javascripts/application.c33a9706.js></script> <script>app.initialize({version:"1.1",url:{base:".."}})</script> <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script> <script src=../js/extra.js></script> </body> </html>